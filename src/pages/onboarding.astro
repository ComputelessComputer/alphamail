---
import BaseLayout from "../layouts/BaseLayout.astro";
---

<BaseLayout title="AlphaMail — Check Your Email">
  <div class="w-full">
    <div class="w-full max-w-md mx-auto px-6 sm:px-8 py-12">
      <!-- Shown to users who already completed onboarding -->
      <div id="already-onboarded" class="hidden text-center">
        <p class="text-neutral-600">Redirecting to your account...</p>
      </div>

      <!-- Default: check your email message -->
      <div id="check-email" class="text-center">
        <div class="text-5xl mb-6">✉️</div>
        <h1 class="text-3xl font-['Song_Myung'] tracking-tight mb-4">check your email!</h1>
        <p class="text-neutral-600 text-lg leading-relaxed">
          alpha just sent you an email.<br>
          <strong>reply to it</strong> with your name and a goal to get started.
        </p>
        <p class="text-neutral-400 text-sm mt-6">
          didn't get it? check your spam folder or <a href="/signup" class="text-blue-600 underline">try again</a>
        </p>
      </div>
    </div>
  </div>
</BaseLayout>

<script>
  import { supabase } from "../lib/supabase";

  // If user is already onboarded, redirect to account
  const { data: { user } } = await supabase.auth.getUser();
  
  if (user) {
    const { data: profile } = await supabase
      .from("profiles")
      .select("onboarded")
      .eq("user_id", user.id)
      .single();

    if (profile?.onboarded) {
      document.getElementById("check-email")!.classList.add("hidden");
      document.getElementById("already-onboarded")!.classList.remove("hidden");
      window.location.href = "/account";
    }
  }
</script>
