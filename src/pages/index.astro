---
import BaseLayout from "../layouts/BaseLayout.astro";

const ctaNote = "Free during early access";
---

<BaseLayout
  title="AlphaMail â€” Weekly goal check-ins by email"
  description="AlphaMail is an AI-powered goal tracking system that keeps you accountable with weekly email check-ins."
>
  <div class="w-full">
    <div class="w-full max-w-2xl mx-auto px-6 sm:px-8 py-12">
      <!-- Headline -->
      <div class="text-center mb-8">
        <h1 class="text-4xl sm:text-5xl font-['Song_Myung'] tracking-tight mb-3">
          AlphaMail
        </h1>
        <p class="text-lg text-neutral-600">
          Weekly goals. Sunday check-ins. Zero apps.
        </p>
      </div>

      <!-- Mock Email Client -->
      <div class="rounded-xl bg-white/80 backdrop-blur-xl shadow-2xl border border-white/20 ring-1 ring-black/5 overflow-hidden flex flex-col w-full text-left mb-10">
        <!-- Window Chrome / Toolbar -->
        <div class="h-12 bg-gradient-to-b from-[#f6f6f6] to-[#e8e8e8] border-b border-[#d1d1d1] flex items-center justify-between px-4 shadow-[0_1px_0_rgba(255,255,255,0.5)_inset]">
          <div class="flex gap-2">
            <div class="w-3 h-3 rounded-full bg-[#FF5F57] border border-[#E09E3E]/30 shadow-sm"></div>
            <div class="w-3 h-3 rounded-full bg-[#FEBC2E] border border-[#DFA023]/30 shadow-sm"></div>
            <div class="w-3 h-3 rounded-full bg-[#28C840] border border-[#1AAB29]/30 shadow-sm"></div>
          </div>
          <a
            id="cta-btn"
            href="/signup"
            class="px-4 h-7 inline-flex items-center rounded-md text-xs font-medium text-white bg-gradient-to-t from-blue-600 to-blue-500 shadow-sm hover:shadow-md hover:scale-[102%] active:scale-[98%] transition-all cursor-pointer"
          >
            <span id="cta-text">Start your first goal</span>
          </a>
        </div>

        <!-- Email Metadata Fields -->
        <div class="flex flex-col bg-white">
          <div class="flex items-center px-4 py-2 border-b border-[#e5e5e5]">
            <span class="text-neutral-400 w-16 text-left mr-3 text-sm font-medium">To:</span>
            <span class="text-neutral-900 text-sm bg-blue-100/50 px-2 py-0.5 rounded text-blue-800">You</span>
          </div>
          <div class="flex items-center px-4 py-2 border-b border-[#e5e5e5]">
            <span class="text-neutral-400 w-16 text-left mr-3 text-sm font-medium">Subject:</span>
            <span class="text-neutral-900 text-sm font-medium">sunday check-in: how's your goal going?</span>
          </div>
          <div class="flex items-center px-4 py-2 border-b border-[#e5e5e5]">
            <span class="text-neutral-400 w-16 text-left mr-3 text-sm font-medium">From:</span>
            <span class="text-neutral-500 text-sm">alpha &lt;alpha@bealphamail.com&gt;</span>
          </div>
        </div>

        <!-- Email Body -->
        <div class="p-5 sm:p-6 bg-white text-neutral-800 text-sm leading-relaxed space-y-3">
          <p>yo! sunday check-in time.</p>
          <p>your goal was: <span class="font-medium">ship the landing page</span></p>
          <p>did you? hit reply - the good, the bad, and your next goal.</p>
          <p class="text-neutral-500">- alpha</p>
        </div>
      </div>

      <!-- CTA Note -->
      <p id="cta-note" class="text-neutral-500 text-center">{ctaNote}</p>
    </div>
  </div>
</BaseLayout>

<script>
  import { supabase } from "../lib/supabase";

  async function updateCTA() {
    const { data: { user } } = await supabase.auth.getUser();
    
    const ctaBtn = document.getElementById("cta-btn") as HTMLAnchorElement;
    const ctaText = document.getElementById("cta-text");
    const ctaNote = document.getElementById("cta-note");

    if (user) {
      const { data: profile } = await supabase
        .from("profiles")
        .select("onboarded")
        .eq("user_id", user.id)
        .single();

      if (profile?.onboarded) {
        if (ctaBtn) ctaBtn.href = "/account";
        if (ctaText) ctaText.textContent = "Go to your account";
        if (ctaNote) ctaNote.textContent = "Welcome back!";
      }
    }
  }

  updateCTA();
</script>
